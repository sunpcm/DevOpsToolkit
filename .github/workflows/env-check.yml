name: Env Consistency Check

on:
  push:
    paths:
      - "ansible/**"
      - "Brewfile"
      - "bootstrap.sh"
      - "scripts/**"
  pull_request:

jobs:
  env-check:
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Bootstrap environment
        run: |
          chmod +x bootstrap.sh
          ./bootstrap.sh

      - name: Load shell env
        run: |
          echo "$HOME/.cargo/bin" >> $GITHUB_PATH
          echo "/home/linuxbrew/.linuxbrew/bin" >> $GITHUB_PATH

      - name: Assert environment
        run: |
          bash scripts/assert-env.sh